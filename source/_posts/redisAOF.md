---
title: Redis AOF
date: 2022-01-18 22:21:15
tags:
  - Redis
categories: 
  - 数据库
  - KV
  - Redis
---

<p></p>
<!-- more -->


## AOF

+ **AOF 日志**正好相反，它是**写后日志**，“写后”的意思是 Redis 是先执行命令，把数据写入内存，然后才记录日志。
+ 而写后日志这种方式，就是先让系统执行命令，只有命令能执行成功，才会被记录到日志中，否则，系统就会直接向客户端报错。
所以，Redis 使用写后日志这一方式的一大好处是，可以避免出现记录错误命令的情况。
+ AOF 还有一个好处：它是在命令执行后才记录日志，所以**不会阻塞当前的写操作**。


## 三种写回策略
+ AOF 配置项  -  appendfsync 的三个可选值
  - **Always**，同步写回：每个写命令执行完，**立马同步地将日志写回磁盘**；
  - **Everysec**，每秒写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，**每隔一秒把缓冲区中的内容写入磁盘**；
  - **No**，操作系统控制的写回：每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，由操作系统决定何时将缓冲区内容写回磁盘。

{% asset_img aof-1.png 三种写回策略 %}

## AOF 非阻塞的重写过程
{% asset_img aof-2.png AOF 非阻塞的重写过程 %}
      
                                      
## 关闭AOF落盘
AOF落盘会带来一定写性能损耗，如果将Redis实例应用于纯缓存场景中，对数据持久化没有需求，您可以按照本章节的说明，修改appendonly参数的值，关闭AOF落盘。

## 参考
[关闭AOF落盘](https://help.aliyun.com/knowledge_detail/147408.html?spm=a2c4g.11186623.2.2.7e373f2e7XKCDO)


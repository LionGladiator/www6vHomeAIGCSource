---
title: Redis可靠性
date: 2021-01-02 21:41:43
tags:
  - Redis
categories: 
  - 数据库
  - 非关系型
  - Redis
---

<p></p>
<!-- more -->

## 一. AOF
[AOF不是WAL，是先操作，后记录日志。]
传统数据库的日志，例如 redo log(重做日志)，记录的是修改后的数据，而AOF里记录的是Redis收到的每一条命令，这些命令是以文本形式保存的。

#### 两个潜在的风险
1. 如果刚执行完一个命令，还没有来得及记日志就宕机了，那么这个命令和相应的数 据就有丢失的风险.
2. AOF 日志也是在主线程中执行的，如果在把日志文件写入磁盘时，磁盘写压力大，就 会导致写盘很慢，进而导致后续的操作也无法执行了.


#### AOF 配置项 appendfsync 的三个可选值。
Always，同步写回: 每个写命令执行完，立马同步地将日志写回磁盘; 
Everysec，每秒写回: 每个写命令执行完，只是先把日志写到 AOF 文件的内存缓冲区，每隔一秒把缓冲区中的内容写入磁盘;
No，操作系统控制的写回: 每个写命令执行完，只是先把日志写到 AOF 文件的内存缓 冲区，由操作系统决定何时将缓冲区内容写回磁盘。


#### AOF 重写Rewrite
一个拷贝，两处日志
{% asset_img   redisRewrite.png  AOF非阻塞的重写过程 %}

## 二. RDB


## 三. AOF+RDB混合


## 参考：
《Redis核心技术与实战》 蒋德钧
04 | AOF日志:宕机了，Redis如何避免数据丢失?




